<!DOCTYPE html>
<html>
<head>
    <title>Gen AI Cost Estimator</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="styles.css">
    <script src="data.js"></script>
</head>
<body>
    <div class="container mt-5">
        <div class="row">
            <div class="col-md-6">
                <div class="form-group">
                    <label for="platformSelect" class="form-label">Platform</label>
                    <select id="platformSelect" class="form-select" onchange="updateModelSelect()">
                        <option value="">Select Platform</option>
                        <!-- Populate platform options dynamically from the tableData object -->
                        <script>
                            for (const platform in tableData) {
                                document.write(`<option value="${platform}">${platform}</option>`);
                            }
                        </script>
                    </select>
                </div>
            </div>
            <div class="col-md-6">
                <div class="form-group">
                    <label for="modelSelect" class="form-label">Model</label>
                    <select id="modelSelect" class="form-select" onchange="updateRateTokens()">
                        <option value="">Select Model</option>
                        <!-- This select will be populated dynamically based on the selected platform -->
                    </select>
                </div>
            </div>
        </div>
        <div class="row mt-4">
            <div class="col-md-6">
                <div class="form-group">
                    <label for="inputRateTokens" class="form-label">Cost per 1K Input Tokens ($)</label>
                    <input type="text" id="inputTokenDisplay" class="form-control" readonly>
                </div>
            </div>
            <div class="col-md-6">
                <div class="form-group">
                    <label for="outputRateTokens" class="form-label">Cost per 1K Output Tokens ($)</label>
                    <input type="text" id="outputTokenDisplay" class="form-control" readonly>
                </div>
            </div>
        </div>
    </div>

    <div class="container mt-5">
        <!-- Nav tabs for Scenario and Custom Tokens -->
        <ul class="nav nav-tabs" id="myTabs">
            <li class="nav-item">
                <button class="nav-link active" id="scenario-tab" data-bs-toggle="tab" data-bs-target="#scenario" role="tab" aria-controls="scenario" aria-selected="true">Scenario</a>
            </li>
            <li class="nav-item">
                <button class="nav-link" id="customTokens-tab" data-bs-toggle="tab" data-bs-target="#customTokens" role="tab" aria-controls="customTokens" aria-selected="false">Custom Tokens</a>
            </li>
        </ul>
        <!-- Tab content -->
        <div class="tab-content" id="myTabContent">
            <div class="tab-pane fade show active" id="scenario" role="tabpanel" aria-labelledby="scenario-tab">
                <div class="row mt-4">
                    <div class="col-md-12">
                        <div class="form-group">
                            <label for="costEstimate" class="form-label">Monthly estimate</label>
                            <textarea id="costEstimate" class="form-control" readonly></textarea>
                        </div>
                    </div>
                </div>
            </div>
            <div class="tab-pane fade" id="customTokens" role="tabpanel" aria-labelledby="customTokens-tab">
                <div class="row mt-4">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="monthlyInputTokens" class="form-label">Total Input Tokens</label>
                            <input type="text" id="monthlyInputTokens" class="form-control">
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="monthlyOutputTokens" class="form-label">Total Output Tokens</label>
                            <input type="text" id="monthlyOutputTokens" class="form-control">
                        </div>
                    </div>
                </div>
                <div class="row mt-4">
                    <div class="col-md-12">
                        <div class="form-group">
                            <label for="customCostEstimate" class="form-label">Custom Estimate</label>
                            <textarea id="customCostEstimate" class="form-control" readonly></textarea>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container mt-5">
        <div class="row">
            <div class="col-md-12">
                <div class="form-group">
                    <span class="styled-text-header">Hello!</span><br><br>
                    <span id="personalMessage" class="styled-text">
                        Thanks for dropping by and we hope you found this useful.
                        <br><br>
                        This is an early beta and will be updated regularly to cover more platforms, more models, self-hosted/instance-hr billing (e.g., SageMaker or Hugging Face) instead of just SaaS-per-token costing, distinct dev & production costing, and the ability to create custom scenarios in order to map your actual personal realistic estimates more easily. Stay tuned!
                        <br><br>
                        This project is on GitHub: <a href="https://github.com/jvroig/genai_cost_estimator/tree/main">Gen AI Cost Estimator</a>. Please feel free to send suggestions or bug reports there, we appreciate it!
                        <br><br>
                        Authors:<br>
                        JV Roig - <a href="https://www.linkedin.com/in/jvroig/">LinkedIn Profile</a><br>
                        Debbie Bastes - <a href="https://www.linkedin.com/in/deborahbastes/">LinkedIn Profile</a>
                    </span>
                </div>
            </div>
        </div>
    </div>

   <!-- Include Bootstrap 5 JS and Popper.js from CDNs -->
   <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.9.2/umd/popper.min.js"></script>

    <script>
        // Function to populate the model select based on the selected platform
        function updateModelSelect() {
            const platformSelect = document.getElementById("platformSelect");
            const modelSelect    = document.getElementById("modelSelect");
            const costEstimate   = document.getElementById("costEstimate");
            const selectedPlatform = platformSelect.value;

            // Clear the current options
            modelSelect.innerHTML = '<option value="">Select Model</option>';

            if (selectedPlatform && tableData[selectedPlatform]) {
                for (const model in tableData[selectedPlatform]) {
                    modelSelect.innerHTML += `<option value="${model}">${model}</option>`;
                }
            }

            inputTokenDisplay.value  = '';
            outputTokenDisplay.value = '';
            costEstimate.value       = '';
        }

        // Function to display rate tokens when a model is selected
        function updateRateTokens() {
            const platformSelect = document.getElementById("platformSelect");
            const modelSelect = document.getElementById("modelSelect");
            const tokenDisplay = document.getElementById("tokenDisplay");

            const selectedPlatform = platformSelect.value;
            const selectedModel = modelSelect.value;

            if (selectedPlatform && selectedModel && tableData[selectedPlatform] && tableData[selectedPlatform][selectedModel]) {
                const modelData = tableData[selectedPlatform][selectedModel];
                inputTokenDisplay.value = modelData.InputRateTokens;
                outputTokenDisplay.value = modelData.OutputRateTokens;
                updateCostEstimate(modelData.InputRateTokens, modelData.OutputRateTokens);

                const monthlyInputTokens  = parseFloat(document.getElementById("monthlyInputTokens").value);
                const monthlyOutputTokens = parseFloat(document.getElementById("monthlyOutputTokens").value);

                //Default to scenario tokens if custom token input is empty
                if (isNaN(monthlyInputTokens)) {
                    document.getElementById("monthlyInputTokens").value = 300 * 1000 * 24 * 30; //FIXME: DRY up, turn this into a variable that all funcs can use
                    document.getElementById("monthlyOutputTokens").value = 250 * 1000 * 24 * 30; //FIXME: DRY up, turn this into a variable that all funcs can use
                }

                updateCustomCostEstimate(modelData.InputRateTokens, modelData.OutputRateTokens)

            } else {
                tokenDisplay.value = "";
            }

        }

        function updateCostEstimate(input_rate, output_rate) {
            const costEstimate = document.getElementById("costEstimate");
            estimate_text = "Assuming you process 1,000 generative AI transactions per hour, 24/7 operations, and each transaction has an average of 300 input tokens and produce an average of 250 output tokens, your 30-day monthly estimate is: $";
            totalInputCost = (input_rate * 300 * 1000 * 24 * 30) / 1000;
            totalOutputCost = (output_rate * 250 * 1000 * 24 * 30) / 1000;
            totalCost = (totalInputCost + totalOutputCost).toLocaleString('en-US', { style: 'decimal', maximumFractionDigits: 2 });

            costEstimate.value = estimate_text + totalCost + "."
        }

        function updateCustomCostEstimate(input_rate, output_rate) {
            const monthlyInputTokens  = parseFloat(document.getElementById("monthlyInputTokens").value);
            const monthlyOutputTokens = parseFloat(document.getElementById("monthlyOutputTokens").value);
            const customCostEstimate = document.getElementById("customCostEstimate");

            if (!isNaN(monthlyInputTokens) && !isNaN(monthlyOutputTokens)) {
                const totalInputCost = (monthlyInputTokens * input_rate) / 1000;
                const totalOutputCost = (monthlyOutputTokens * output_rate) / 1000;
                const totalCost = (totalInputCost + totalOutputCost).toLocaleString('en-US', { style: 'decimal', maximumFractionDigits: 2 });

                in_tokens = parseFloat(monthlyInputTokens).toLocaleString();
                out_tokens = parseFloat(monthlyOutputTokens).toLocaleString();
                customCostEstimate.value = `Your total cost estimate for ${in_tokens} input tokens and ${out_tokens} output tokens is: $${totalCost}`;
            } else {
                customCostEstimate.value = 'Please enter valid numbers for input and output tokens.';
            }
        }

        // Add event listener for custom estimate calculation
        document.getElementById("monthlyInputTokens").addEventListener("input", updateRateTokens);
        document.getElementById("monthlyOutputTokens").addEventListener("input", updateRateTokens);

    </script>
</body>
</html>
